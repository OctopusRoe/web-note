## Go语言的包(package)

---

在工程化的Go语言开发项目中，Go语言的源码复用是建立在包(package)基础之上的

### package 介绍

`package` 是多个Go语言源码的集合，是一种高级的代码复用方案，Go语言为我们提供了很多内置的包

### 定义 package

可以根据需求创建属于项目的包，一个包可以简单理解为一个存放 `.go` 后缀文件的文件夹，该文件夹下面的所有go文件都要在代码的第一行添加代码，声明该文件归属的 package

```go
package 包名
```

1. 一个文件夹下面直接包含的文件只能归属于一个 package，同样一个 package 的文件不能在多个文件夹下
2. 包名可以不喝文件夹的名字一样，而且包名不能包含 `-` 符号
3. 包名为 `main` 的包为应用程序的入口包，这种包编译后会得到一个可执行文件，而编译不含 `main` 的包则不会得到可执行文件

### 私有性

如果想在一个包中引用另一个包里的标识符(如变量、常量、类型、函数等)时，该标识符必须是对外可见的 (public)，在Go语言中只需要将标识符的首字母大写就可以让标识符对外可见

```go
package pkg1

/* 首字母小写，外部包不可见，只能在当前包内使用 */
var a = 1

/* 首字母大写，外部包可见，可在其他包中使用 */
var B = 2

type person struct {
    /* 首字母小写，外部包不可见，只能在当前包内使用 */
    name string
}

type city struct {
    /* 首字母大写，外部包可见，可在其他包中使用 */
    Position string
}

/* 首字母大写，外部包可见，可在其他包中使用 */
func Add(x,y int) int {
    return x + y
}

/* 首字母小写，外部包不可见，只能在当前包内使用 */
func test() {
    /* 函数局部变量，外部包不可见，只能在当前函数中使用 */
    var A = 1
}
```

结构体中的字段名和接口中的方法名如果首字母都是大写，则外部包可以访问这些字段和方法

```go
type person struct {
    Name string     // 外部包可以访问的字段
    age int         // 外部包不可以访问的字段
}

type city interface {
    Position()      // 外部包可以访问的方法
    play()          // 外部包不可以访问的方法
}
```

### 包的导入

如果要在代码中引用其他包的内容，需要使用 `import` 关键字来导入需要使用的包

```go
import "包的路径 | 包名"
```

1. `import` 导入语句通常放在文件开头包声明语句的下面
2. 导入的包名需要使用 `""` 包裹起来
3. 包名是从 `$GOPATH/src/` 后开始计算的，使用 `/` 进行路径分隔
4. Go语言中禁止循环导入包

#### 单行导入包

```go
import "fmt"
import "io"
```

#### 多行导入包

```go
import (
    "fmt"
    "io"
)
```

### 自定义包名

在导入包名的时候，可以为导入的包设置别名，通常用于导入的包名过长或者导入的包名冲突的情况

```go
import 别名 "包的路径 | 包名"
```

单行导入方式定义别名

```go
import f "fmt"

f.Println(3+2)
```

多行导入方式定义别名

```go
import (
    "io"
    f "fmt"
)

f.Println(3+2)
```

### 匿名导入包

如果只希望导入包，而不使用包内部的数据时，可以使用匿名导入

```go
import _ "包的路径 | 包名"
```

匿名导入的包与其他方式导入的包一样都会被编译到可执行文件中

### init() 初始化函数

在Go语言程序执行时，导入包语句会自动触发包内部的 `init()` 函数的调用，`init()` 函数没有参数也没有返回值

`init()` 函数在程序运行时自动被调用执行，不能再代码中主动调用

包初始化执行的顺序如下图

![](../../images/golang/package/init01.png)

#### init() 函数执行顺序

Go语言包会从 `main` 包开始检查其导入的所有包，每个包中又可能导入了其他的包，Go编译器由此构建出一个树状的包引用关系，在根据引用顺序决定编译的顺序，依次编译这些包的代码

在运行时，被最后导入的包会最先初始化并调用其 `init()` 函数

![](../../images/golang/package/init02.png)